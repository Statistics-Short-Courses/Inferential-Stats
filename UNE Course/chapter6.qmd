---
title: "Chi-square tests"
---

Our last set of statistical analysis tests are **chi-square tests**. These tests are looking at association patterns between either two categorical variables or one categorical variable with specific proportions. 

When you are comparing two categorical variables, this is called a **chi-square test of independence**.

When you are comparing one categorical variable with specific proportions, this is called a **chi-square goodness of fit test**.

# Chi-square Goodness of Fit Test 

`living_well`

<https://www.aihw.gov.au/reports/overweight-obesity/overweight-and-obesity/contents/measuring-overweight-and-obesity>

<https://www.abs.gov.au/statistics/health/health-conditions-and-risks/hypertension-and-high-measured-blood-pressure/latest-release>

```{r}

```

# Chi-square Test of Independence 

Let's go back to our ECEC dataset from Chapter 4.

```{r, message=FALSE}
library(dplyr) 
library(tidyr) 
library(ggplot2)  
library(forcats)
library(ggmosaic)
ecec <- read.csv("Data sets/ecec-survey-2023.csv") 
```

Is the distribution of income categories the same for different gender groups?

```{r}
ecec_chi <- ecec %>%
  rename(
    Gender = SQ1,
    Annual_Income = D13
  ) %>%
  select(Gender, Annual_Income) %>%
  drop_na(Gender, Annual_Income) %>%
  mutate(across(c(Gender, Annual_Income), as.factor))%>%
  filter(Gender %in% c("Male", "Female")) %>%
  filter(Annual_Income != "Prefer not to answer") %>%
  droplevels() 

```

```{r}
str(ecec_chi)
```

```{r}
ecec_chi3 <- ecec_chi %>%
  mutate(Income_Group = fct_collapse(
    Annual_Income,
    `Zero/Neg` = "Negative or Zero Income",
    `<50k` = c("$1 - $19,999 per year ($1 - $379 per week)",
               "$20,000 - $29,999 per year ($380 - $579 per week)",
               "$30,000 - $39,999 per year ($580 - $769 per week)",
               "$40,000 - $49,999 per year ($770 - $959 per week)"),
    `50k-100k` = c("$50,000 - $59,999 per year ($960 - $1149 per week)",
                   "$60,000 - $79,999 per year ($1150 - $1529 per week)",
                   "$80,000 - $99,999 per year ($1530 - $1919 per week)"),
    `100k-150k` = c("$100,000 - $124,999 per year ($1920 - $2399 per week)",
                    "$125,000 - $149,999 per year ($2400 - $2879 per week)"),
    `150k+` = c("$150,000 - $199,999 per year ($2880 - $3839 per week)",
                "$200,000 - $249,999 per year ($3840 - $4799 per week)",
                "$250,000 - $299,999 per year ($4800 - $5759 per week)",
                "$300,000 or more per year ($5760 or more per week)")
  ))

ggplot(ecec_chi3) +
  geom_mosaic(aes(x = product(Income_Group), 
                  fill = Gender, 
                  weight = 1),
              color = "white", size = 0.2) +
  theme_minimal() +
  labs(title = "Mosaic Plot: Gender by Income Group")

```

```{r}
a <- chisq.test(table(ecec_chi$Annual_Income,ecec_chi$Gender))

a$expected
```

```{r}
ecec_chi <- ecec_chi %>%
  mutate(Annual_Income = fct_collapse(
    Annual_Income,
    `Under $20k` = c("Negative or Zero Income",
                     "$1 - $19,999 per year ($1 - $379 per week)")
  ))
chisq.test(table(ecec_chi$Annual_Income,ecec_chi$Gender))
```
